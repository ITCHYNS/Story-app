const CACHE_NAME="story-map-v3",urlsToCache=["/","/index.html","/app.bundle.js","/styles.css","/favicon.png"];self.addEventListener("install",(e=>{console.log("Service Worker installing"),e.waitUntil(caches.open(CACHE_NAME).then((e=>(console.log("Caching app shell"),e.addAll(urlsToCache)))).then((()=>(console.log("Service Worker installed, skipping waiting."),self.skipWaiting()))).catch((e=>{console.error("Cache addAll failed:",e)})))})),self.addEventListener("activate",(e=>{console.log("Service Worker activating"),e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>{if(e!==CACHE_NAME)return console.log("Deleting old cache:",e),caches.delete(e)}))))).then((()=>(console.log("Service Worker activated, claiming clients."),self.clients.claim()))))})),self.addEventListener("fetch",(e=>{e.respondWith(caches.match(e.request).then((t=>t||fetch(e.request))))})),self.addEventListener("push",(e=>{if(!e.data)return void console.log("Push received with no data");let t="Story Map",n="You have a new notification.";const i="/favicon.png";let o="/";try{const i=e.data.json();t=i.title||t,n=i.body||n,o=i.url||o}catch(t){console.log("Push data is not JSON, treating as text."),n=e.data.text()}const a={body:n,icon:i,badge:i,tag:"story-map-notification",data:{url:o}};e.waitUntil(self.registration.showNotification(t,a))})),self.addEventListener("notificationclick",(e=>{e.notification.close();const t=e.notification.data.url||"/";e.waitUntil(clients.matchAll({type:"window"}).then((e=>{for(const n of e)if(n.url.includes(t)&&"focus"in n)return n.focus();if(clients.openWindow)return clients.openWindow(t)})))}));